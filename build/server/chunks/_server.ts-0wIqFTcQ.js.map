{"version":3,"file":"_server.ts-0wIqFTcQ.js","sources":["../../../.svelte-kit/adapter-node/entries/endpoints/api/guild/updateSettings/_server.ts.js"],"sourcesContent":["import { json } from \"@sveltejs/kit\";\nimport { p as pool } from \"../../../../../chunks/config.js\";\nasync function POST({ request }) {\n  try {\n    const { guild, setting, value } = await request.json();\n    if (!guild || setting === void 0 || value === void 0) {\n      return json({ success: false, error: \"Missing required parameters\" }, { status: 400 });\n    }\n    console.log(\"Received request:\", { guild, setting, value });\n    if (setting === \"displaySeeds\") {\n      console.log(\"Executing query with values:\", { guild, hideseed: !value });\n      const updateResult = await pool.query(\n        `UPDATE GUILDSETTINGS \n                 SET hideseed = $2 \n                 WHERE guild = $1\n                 RETURNING *`,\n        [guild, !value]\n      );\n      if (updateResult.rowCount === 0) {\n        const insertResult = await pool.query(\n          `INSERT INTO GUILDSETTINGS (guild, hideseed)\n                     VALUES ($1, $2)\n                     RETURNING *`,\n          [guild, !value]\n        );\n        console.log(\"Inserted new row:\", insertResult.rows[0]);\n      } else {\n        console.log(\"Updated existing row:\", updateResult.rows[0]);\n      }\n    } else if (setting === \"telegram\") {\n      const { token, chatId } = value;\n      const updateResult = await pool.query(\n        `UPDATE GUILDSETTINGS\n                 SET telegram_bot_token = $2, telegram_chat_id = $3\n                 WHERE guild = $1\n                 RETURNING *`,\n        [guild, token, chatId]\n      );\n      if (updateResult.rowCount === 0) {\n        await pool.query(\n          `INSERT INTO GUILDSETTINGS (guild, telegram_bot_token, telegram_chat_id)\n                     VALUES ($1, $2, $3)`,\n          [guild, token, chatId]\n        );\n      }\n    }\n    return json({ success: true });\n  } catch (err) {\n    const error = err;\n    console.error(\"Detailed error:\", {\n      message: error.message,\n      code: error.code,\n      detail: error.detail\n    });\n    return json({\n      success: false,\n      error: \"Internal server error\",\n      detail: error.message\n    }, { status: 500 });\n  }\n}\nexport {\n  POST\n};\n"],"names":[],"mappings":";;;;;AAEA,eAAe,IAAI,CAAC,EAAE,OAAO,EAAE,EAAE;AACjC,EAAE,IAAI;AACN,IAAI,MAAM,EAAE,KAAK,EAAE,OAAO,EAAE,KAAK,EAAE,GAAG,MAAM,OAAO,CAAC,IAAI,EAAE;AAC1D,IAAI,IAAI,CAAC,KAAK,IAAI,OAAO,KAAK,KAAK,CAAC,IAAI,KAAK,KAAK,KAAK,CAAC,EAAE;AAC1D,MAAM,OAAO,IAAI,CAAC,EAAE,OAAO,EAAE,KAAK,EAAE,KAAK,EAAE,6BAA6B,EAAE,EAAE,EAAE,MAAM,EAAE,GAAG,EAAE,CAAC;AAC5F,IAAI;AACJ,IAAI,OAAO,CAAC,GAAG,CAAC,mBAAmB,EAAE,EAAE,KAAK,EAAE,OAAO,EAAE,KAAK,EAAE,CAAC;AAC/D,IAAI,IAAI,OAAO,KAAK,cAAc,EAAE;AACpC,MAAM,OAAO,CAAC,GAAG,CAAC,8BAA8B,EAAE,EAAE,KAAK,EAAE,QAAQ,EAAE,CAAC,KAAK,EAAE,CAAC;AAC9E,MAAM,MAAM,YAAY,GAAG,MAAM,IAAI,CAAC,KAAK;AAC3C,QAAQ,CAAC;AACT;AACA;AACA,4BAA4B,CAAC;AAC7B,QAAQ,CAAC,KAAK,EAAE,CAAC,KAAK;AACtB,OAAO;AACP,MAAM,IAAI,YAAY,CAAC,QAAQ,KAAK,CAAC,EAAE;AACvC,QAAQ,MAAM,YAAY,GAAG,MAAM,IAAI,CAAC,KAAK;AAC7C,UAAU,CAAC;AACX;AACA,gCAAgC,CAAC;AACjC,UAAU,CAAC,KAAK,EAAE,CAAC,KAAK;AACxB,SAAS;AACT,QAAQ,OAAO,CAAC,GAAG,CAAC,mBAAmB,EAAE,YAAY,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC;AAC9D,MAAM,CAAC,MAAM;AACb,QAAQ,OAAO,CAAC,GAAG,CAAC,uBAAuB,EAAE,YAAY,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC;AAClE,MAAM;AACN,IAAI,CAAC,MAAM,IAAI,OAAO,KAAK,UAAU,EAAE;AACvC,MAAM,MAAM,EAAE,KAAK,EAAE,MAAM,EAAE,GAAG,KAAK;AACrC,MAAM,MAAM,YAAY,GAAG,MAAM,IAAI,CAAC,KAAK;AAC3C,QAAQ,CAAC;AACT;AACA;AACA,4BAA4B,CAAC;AAC7B,QAAQ,CAAC,KAAK,EAAE,KAAK,EAAE,MAAM;AAC7B,OAAO;AACP,MAAM,IAAI,YAAY,CAAC,QAAQ,KAAK,CAAC,EAAE;AACvC,QAAQ,MAAM,IAAI,CAAC,KAAK;AACxB,UAAU,CAAC;AACX,wCAAwC,CAAC;AACzC,UAAU,CAAC,KAAK,EAAE,KAAK,EAAE,MAAM;AAC/B,SAAS;AACT,MAAM;AACN,IAAI;AACJ,IAAI,OAAO,IAAI,CAAC,EAAE,OAAO,EAAE,IAAI,EAAE,CAAC;AAClC,EAAE,CAAC,CAAC,OAAO,GAAG,EAAE;AAChB,IAAI,MAAM,KAAK,GAAG,GAAG;AACrB,IAAI,OAAO,CAAC,KAAK,CAAC,iBAAiB,EAAE;AACrC,MAAM,OAAO,EAAE,KAAK,CAAC,OAAO;AAC5B,MAAM,IAAI,EAAE,KAAK,CAAC,IAAI;AACtB,MAAM,MAAM,EAAE,KAAK,CAAC;AACpB,KAAK,CAAC;AACN,IAAI,OAAO,IAAI,CAAC;AAChB,MAAM,OAAO,EAAE,KAAK;AACpB,MAAM,KAAK,EAAE,uBAAuB;AACpC,MAAM,MAAM,EAAE,KAAK,CAAC;AACpB,KAAK,EAAE,EAAE,MAAM,EAAE,GAAG,EAAE,CAAC;AACvB,EAAE;AACF;;;;"}